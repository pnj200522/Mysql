### SUBQUERY 2

## FROM 절에 SUBQUERY가 정의 된 경우

# EMP 테이블에 저장된 사원들을 출력. 사원번호가 빠른 다섯명만 출력

SELECT ENAME, EMPNO FROM (SELECT * FROM EMP ORDER BY HIREDATE DESC);



# EMP 테이블에 사원들 중 입사일자를 내림차순으로 정렬한 결과를 출력하는데 상위 10 건만 출력하시오.

SELECT ENAME, EMPNO FROM (SELECT * FROM EMP ORDER BY HIREDATE DESC) 
WHERE ROWNUM <= 10;



# EMP 테이블에 입사 일자가 빠른 사원 열 명 만 출력

SELECT ROWNUM, IV.* FROM (SELECT * FROM EMP ORDER BY HIREDATE) IV
WHERE ROWNUM <= 10;



# EMP 테이블의 사원 정보를 활용해 회사의 평균 급여 보다 많은 급여를 받는 사원을 회사의 평균 급여와 함께 출력하시오.

SELECT E.EMPNO, E.SAL, SQ.AVG_S FROM EMP E, (SELECT AVG(SAL) AVG_S FROM EMP) SQ
WHERE E.SAL > SQ.AVG_S;



# EMP 테이블에서 각 부서의 평균 급여보다 많은 급여를 받는 사원을 부서의 평균 급여와 함께 출력하시오.

SELECT * FROM EMP E JOIN (SELECT DEPTNO, AVG(SAL) AS "AVG_S" FROM EMP GROUP BY DEPTNO) A
ON E.DEPTNO = A.DEPTNO 
WHERE E.SAL > A.AVG_S;



# SELECT & ORDER BY 절에 SUBQUERY가 정의 된 경우 (SCALAR SUBQUERY만 사용 가능)

SELECT EMPLOYEE_ID, LAST_NAME, DEPARTMENT_ID FROM EMPLOYEES E
ORDER BY (SELECT DEPARTMENT_NAME FROM DEPARTMENTS WHERE DEPARTMENT_ID = E.DEPARTMENT_ID);



# SCALAR SUBQUERY를 사용하여 부서의 급여 합을 산출하시오.

SELECT DEPTNO, DNAME, LOC, (SELECT SUM(SAL) FROM EMP WHERE DEPTNO = D.DEPTNO) FROM DEPT D;



## 부서 별, 급여 함, 평균 급여를 산출하기 위해서는...

SELECT DEPTNO, (SELECT SUM(SAL) FROM EMP WHERE DEPTNO = D.DEPTNO) SU_SAL
, (SELECT AVG(SAL) FROM EMP WHERE DEPTNO = D.DEPTNO) AV_SAL
FROM DEPT D;

# JOIN과 SUBQUERY를 사용하여 결과를 출력.

SELECT D.DEPTNO, A.SS, A.SA FROM DEPT D JOIN (SELECT SUM(SAL) SS, AVG(SAL) SA, DEPTNO FROM EMP GROUP BY DEPTNO) A
ON D.DEPTNO = A.DEPTNO;
